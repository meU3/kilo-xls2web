# kilo-xls2web

Система для автоматической обработки прайс-листов поставщиков в формате .xls и их преобразования в стилизованные .xlsx файлы, а также для генерации HTML-страницы с ссылками на эти файлы. Система также поддерживает выгрузку сгенерированных файлов на FTP-сервер.

## Назначение системы

Система `xls2web` предназначена для автоматической обработки прайс-листов поставщиков в формате `.xls` и их преобразования в стилизованные `.xlsx` файлы, а также для генерации `HTML`-страницы с ссылками на эти файлы. Система также поддерживает выгрузку сгенерированных файлов на `FTP`-сервер.

## Ключевые технологии

* **Язык:** `PHP`
* **Основная библиотека:** `phpoffice/phpspreadsheet` для работы с Excel-файлами.
* **База данных:** `SQLite` для временного хранения и обработки данных из прайс-листов.

## Архитектура и компоненты

### Конфигурационные файлы (`/pages/config`):
* `suppliers_config.php`: "Сердце" системы. Здесь для каждого поставщика (ключа прайс-листа) определяется:
    * URL-адрес исходного `.xls` файла.
    * Правила парсинга (с какой строки начинать, где какая колонка).
    * Правила обработки данных (например, процент наценки).
    * Настройки для выходного файла (имя, логотип, порядок колонок).
* `template_config.php`: Определяет внешний вид и функционал:
    * Стили, цвета и шрифты для `.xlsx` файлов.
    * Контактные данные менеджера.
    * Настройки `FTP` для выгрузки.
* `paths_config.php`: Определяет глобальные пути к директориям проекта.

### Модули приложения (`/pages/app`):
* `excel_importer.php`: Отвечает загрузку исходного `.xls` файла, его парсинг согласно правилам из `suppliers_config.php` и сохранение данных в `SQLite` базу.
* `excel_generator.php`: Отвечает за создание нового `.xlsx` файла на основе данных из `SQLite`, применяя стили и шаблоны из `template_config.php`.
* `database.php`: Содержит функцию для подключения к `SQLite`.
* `AppLogger.php`: Класс для логирования процесса.

### Скрипты запуска:
* `run.php`: Скрипт для **ручного** запуска обработки **одного** конкретного прайс-листа. Принимает ключ прайс-листа как аргумент командной строки (например, `php run.php Anrex_Brilan`). Этот скрипт **не** выгружает файлы на `FTP`.
* `run_all.php`: (Предположительно) Скрипт для **автоматического** (например, по крону) запуска обработки **всех** прайс-листов, описанных в `suppliers_config.php`, и последующей выгрузки на `FTP`.

## Процесс работы

1. Загрузка .xls по URL
2. Парсинг данных
3. Сохранение в SQLite
4. Чтение данных из SQLite
5. Создание .xlsx файла
6. Применение стилей и шаблонов
7. Сохранение .xlsx в /data/generated_files
8. Генерация index.html
9. Выгрузка на FTP

## Установка и настройка

1. Установите зависимости: `composer install`
2. Настройте конфигурационные файлы в `/pages/config/`
3. Запустите обработку: `php run_all.php`

## Автор

Kilo Code