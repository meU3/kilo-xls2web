# Бриф системы "xls2web"

## 1. Назначение системы

Система `xls2web` предназначена для автоматической обработки прайс-листов поставщиков в формате `.xls` и их преобразования в стилизованные `.xlsx` файлы, а также для генерации `HTML`-страницы с ссылками на эти файлы. Система также поддерживает выгрузку сгенерированных файлов на `FTP`-сервер.

## 2. Ключевые технологии

*   **Язык:** `PHP`
*   **Основная библиотека:** `phpoffice/phpspreadsheet` для работы с Excel-файлами.
*   **База данных:** `SQLite` для временного хранения и обработки данных из прайс-листов.

## 3. Архитектура и компоненты

Система состоит из следующих основных частей:

*   **Конфигурационные файлы (`/pages/config`):**
    *   `suppliers_config.php`: "Сердце" системы. Здесь для каждого поставщика (ключа прайс-листа) определяется:
        *   URL-адрес исходного `.xls` файла.
        *   Правила парсинга (с какой строки начинать, где какая колонка).
        *   Правила обработки данных (например, процент наценки).
        *   Настройки для выходного файла (имя, логотип, порядок колонок).
    *   `template_config.php`: Определяет внешний вид и функционал:
        *   Стили, цвета и шрифты для `.xlsx` файлов.
        *   Контактные данные менеджера.
        *   Настройки `FTP` для выгрузки.
    *   `paths_config.php`: Определяет глобальные пути к директориям проекта.

*   **Модули приложения (`/pages/app`):**
    *   `excel_importer.php`: Отвечает за загрузку исходного `.xls` файла, его парсинг согласно правилам из `suppliers_config.php` и сохранение данных в `SQLite` базу.
    *   `excel_generator.php`: Отвечает за создание нового `.xlsx` файла на основе данных из `SQLite`, применяя стили и шаблоны из `template_config.php`.
    *   `database.php`: Содержит функцию для подключения к `SQLite`.
    *   `AppLogger.php`: Класс для логирования процесса.

*   **Скрипты запуска:**
    *   `run.php`: Скрипт для **ручного** запуска обработки **одного** конкретного прайс-листа. Принимает ключ прайс-листа как аргумент командной строки (например, `php run.php Anrex_Brilan`). Этот скрипт **не** выгружает файлы на `FTP`.
    *   `run_all.php`: (Предположительно) Скрипт для **автоматического** (например, по крону) запуска обработки **всех** прайс-листов, описанных в `suppliers_config.php`, и последующей выгрузки на `FTP`.

## 4. Процесс работы (Workflow)

```mermaid
graph TD;
    subgraph "Этап 1: Импорт (excel_importer.php)"
        A[Загрузка .xls по URL] --> B{Парсинг данных};
        B --> C[Сохранение в SQLite];
    end

    subgraph "Этап 2: Генерация (excel_generator.php)"
        C --> D[Чтение данных из SQLite];
        D --> E{Создание .xlsx файла};
        E --> F[Применение стилей и шаблонов];
    end

    subgraph "Этап 3: Публикация (run_all.php)"
        F --> G[Сохранение .xlsx в /data/generated_files];
        G --> H{Генерация index.html};
        H --> I{Выгрузка на FTP};
    end

    style A fill:#f9f,stroke:#333,stroke-width:2px
    style E fill:#ccf,stroke:#333,stroke-width:2px
    style I fill:#cfc,stroke:#333,stroke-width:2px